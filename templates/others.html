<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Baloo&display=swap" rel="stylesheet" />
        <link rel="icon" type="image/x-icon" href="../static/images/favicon.png">
        <link href="{{ url_for('static', filename='css/others.css') }}" rel="stylesheet" />
        <title>Laundrylink - Others</title>
    </head>
    <body>
        <div class="v100_93">
            <div class="v100_94"></div>
            <div class="v100_133" onclick="openDetergentModal()"></div>
            <div class="v100_140" onclick="document.getElementById('ownDetergentBtn').click()"></div>
            <div class="v100_138" onclick="openFabconModal()"></div>
            <div class="v100_151" onclick="document.getElementById('ownFabconBtn').click()"></div>
            <span class="v100_95">OPTIONS</span>
            {% if order_type != 'Self-service' %}
            <span class="v100_161">OTHER</span>
            {% endif %}
            <form id="othersForm" action="{{ url_for('submit_others') }}" method="post">
                <input type="hidden" name="pickup_date" id="hiddenPickupDate" />
                <input type="hidden" name="pickup_time" id="hiddenPickupTime" />
                <input type="hidden" name="order_note" id="hiddenOrderNote" />
                                
                <div class="button-container">
                    <div class="v100_98">
                        <a href="{{ url_for('weight_laundry') }}" class="v100_99">Previous</a>
                    </div>
                    <div class="v100_96">
                        <button class="v100_97" type="submit">Next</button>
                    </div>
                </div>
                <div class="v100_100">
                    <div class="v100_101"></div>
                    <div class="v100_102"></div>
                    <div class="v100_103"></div>
                    <div class="v100_104"></div>
                    <div class="v100_105"></div>
                    <div class="v100_106"></div>
                    <div class="v100_107"></div>
                    <div class="v100_108"></div>
                    <div class="v100_109"></div>
                    <span class="v100_110">3</span>
                </div>
                <span class="v100_111">YOU</span>
                
                <!-- Trigger Button -->
                <button class="v100_145" type="button" onclick="openDetergentModal()">DETERGENT</button>

                <!-- Modal -->
                <div id="detergentModal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeDetergentModal()">&times;</span>
                        <h2>SELECT DETERGENT</h2>
                        {% for detergent in detergents %}
                        <div class="detergent-option">
                            <input type="checkbox" id="detergent_{{ detergent.DETERGENT_ID }}" name="detergent_ids" value="{{ detergent.DETERGENT_ID }}" class="detergent-checkbox" />
                            <label for="detergent_{{ detergent.DETERGENT_ID }}">
                                <img src="{{ url_for('static', filename='uploads/' ~ (detergent.IMAGE_FILENAME or 'default_detergent.jpg')) }}" alt="{{ detergent.DETERGENT_NAME }}">
                                <div class="details">
                                    <strong>{{ detergent.DETERGENT_NAME }}</strong>
                                    <span>Php {{ '%.2f'|format(detergent.DETERGENT_PRICE) }}</span>
                                </div>
                                <div class="quantity">
                                    <button type="button" onclick="changeQty('detergent_qty_{{ detergent.DETERGENT_ID }}', -1)">-</button>
                                    <input type="number" min="1" value="1" name="detergent_qty_{{ detergent.DETERGENT_ID }}" id="detergent_qty_{{ detergent.DETERGENT_ID }}" />
                                    <button type="button" onclick="changeQty('detergent_qty_{{ detergent.DETERGENT_ID }}', 1)">+</button>
                                </div>
                                <input type="hidden" name="detergent_price_{{ detergent.DETERGENT_ID }}" value="{{ detergent.DETERGENT_PRICE }}" />
                            </label>
                        </div>
                        {% endfor %}
                        <div class="modal-buttons">
                            <button type="button" class="submit" onclick="closeDetergentModal()">Done</button>
                            <button type="button" class="cancel" onclick="closeDetergentModal()">Cancel</button>
                        </div>
                    </div>
                </div>
                <div class="v100_157"></div>
                <div class="v100_158"></div>
                <div class="v100_159"></div>
                <button class="v100_149" type="button" id="ownDetergentBtn">OWN DETERGENT</button>
                <input type="hidden" name="own_detergent" id="ownDetergentInput" value="0" />
                <button class="v100_154" type="button" id="ownFabconBtn">OWN FABCON</button>
                <input type="hidden" name="own_fabcon" id="ownFabconInput" value="0" />
                <div class="v100_160"></div>
                <button class="v100_147" type="button" onclick="openFabconModal()">FABCON</button>

                <!-- FABCON Modal -->
                <div id="fabconModal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeFabconModal()">&times;</span>
                        <h2>SELECT FABCON</h2>
                        {% for fabcon in fabric_conditioners %}
                        <div class="detergent-option">
                            <input type="checkbox" id="fabcon_{{ fabcon.FABCON_ID }}" name="fabcon_ids" value="{{ fabcon.FABCON_ID }}" class="fabcon-checkbox" />
                            <label for="fabcon_{{ fabcon.FABCON_ID }}">
                                <img src="{{ url_for('static', filename='uploads/' ~ (fabcon.IMAGE_FILENAME or 'default_fabcon.jpg')) }}" alt="{{ fabcon.FABCON_NAME }}">
                                <div class="details">
                                    <strong>{{ fabcon.FABCON_NAME }}</strong>
                                    <span>Php {{ '%.2f'|format(fabcon.FABCON_PRICE) }}</span>
                                </div>
                                <div class="quantity">
                                    <button type="button" onclick="changeQty('fabcon_qty_{{ fabcon.FABCON_ID }}', -1)">-</button>
                                    <input type="number" min="1" value="1" name="fabcon_qty_{{ fabcon.FABCON_ID }}" id="fabcon_qty_{{ fabcon.FABCON_ID }}" />
                                    <button type="button" onclick="changeQty('fabcon_qty_{{ fabcon.FABCON_ID }}', 1)">+</button>
                                </div>
                                <input type="hidden" name="fabcon_price_{{ fabcon.FABCON_ID }}" value="{{ fabcon.FABCON_PRICE }}" />
                            </label>
                        </div>
                        {% endfor %}
                        <div class="modal-buttons">
                            <button type="button" class="submit" onclick="closeFabconModal()">Done</button>
                            <button type="button" class="cancel" onclick="closeFabconModal()">Cancel</button>
                        </div>
                    </div>
                </div>
                <span class="v100_112">WEIGH</span>
                {% if order_type != 'Self-service' %}
                <span class="v100_113">OTHER</span>
                {% endif %}
                <span class="v100_114">PAYMENT</span>
                <div class="v91_256"></div>
                {% if order_type != 'Self-service' %}
                <div class="v100_163"></div>
                <div class="v100_165"></div>
                <span class="v100_267">Php 70.00</span>
                <div class="v100_177"></div>
                <button class="v100_167" type="button" id="ironBtn">IRON</button>
                <input type="hidden" name="iron" id="ironInput" value="0" />
                <span class="v100_265">Php 50.00</span>
                <button class="v100_173" type="button" id="foldBtn">FOLD</button>
                <input type="hidden" name="fold" id="foldInput" value="0" />
                <div class="v100_176"></div>
                <div class="v244_284"></div>
                <!-- <div class="v244_285"></div> -->
                <button class="v244_288" type="button" id="priorityBtn">PRIORITY ORDER</button>
                <input type="hidden" name="priority" id="priorityInput" value="0" />
                <span class="v244_289">Php 50.00</span>
                <div class="v245_301"></div>
                <div class="v245_297"></div>
                <div class="v245_304"></div>

                <!-- SCHEDULE PICKUP -->
                <button class="v245_298" type="button" onclick="document.getElementById('scheduleModal').style.display='block'">SCHEDULE PICKUP</button>
                {% endif %}
                <!-- Price totals - visible for both Self-service and Drop-off -->
                <span class="v100_269" id="detergentTotal">Price: 0.00</span>
                <span class="v100_273" id="fabconTotal">Price: 0.00</span>
                {% if order_type != 'Self-service' %}
                <div id="scheduleModal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeScheduleModal()">&times;</span>
                        <h2>Schedule Pickup</h2>
                        <p class="note">*No Pickups on Tuesdays/Holidays â€“ Please select another day.</p>
                        <div class="form-group">
                            <label for="pickup-date">Date</label>
                            <div class="input-icon">
                                <input type="date" id="pickup-date" name="pickup-date" onchange="validatePickupDate()" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pickup-time">Time (6:00 AM - 6:00 PM)</label>
                            <div class="input-icon">
                                <input type="time" id="pickup-time" name="pickup-time" min="06:00" max="18:00" onchange="validatePickupTime()" />
                            </div>
                        </div>
                        <div class="modal-buttons">
                            <button type="button" class="submit" onclick="saveSchedule()">Submit</button>
                            <button type="button" class="cancel" onclick="closeScheduleModal()">Cancel</button>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- ADD NOTE -->
                <div class="v244_285"></div>
                <div class="v245_296"></div>
                <button class="v244_290" type="button" onclick="document.getElementById('noteModal').style.display='block'">ADD NOTE</button>
                <div id="noteModal" class="modal">
                    <div class="modal-content note-modal">
                        <span class="close" onclick="document.getElementById('noteModal').style.display='none'">&times;</span>
                        <h2>Note</h2>
                        <div class="note-text-area">
                            <textarea id="note-text" placeholder="You can write your note here..."></textarea>
                        </div>
                        <div class="modal-buttons">
                            <button type="button" class="submit" onclick="saveNote()">Submit</button>
                            <button type="button" class="cancel" onclick="document.getElementById('noteModal').style.display='none'">Cancel</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
</body>
<script>
    function toggleBoxHighlight(boxClass, isSelected) {
        const box = document.querySelector(boxClass);
        if (box) {
            if (isSelected) {
                box.classList.add('selected');
            } else {
                box.classList.remove('selected');
            }
        }
    }

    function openDetergentModal() {
        document.getElementById('detergentModal').style.display = 'block';
    }
    function closeDetergentModal() {
        document.getElementById('detergentModal').style.display = 'none';
    }
    function openFabconModal() {
        document.getElementById('fabconModal').style.display = 'block';
    }
    function closeFabconModal() {
        document.getElementById('fabconModal').style.display = 'none';
    }
    function openScheduleModal() {
        const modal = document.getElementById('scheduleModal');
        if (modal) {
            modal.style.display = 'block';
        }
    }
    function closeScheduleModal() {
        const modal = document.getElementById('scheduleModal');
        if (modal) {
            modal.style.display = 'none';
        }
    }
    
    function changeQty(inputId, delta) {
        var input = document.getElementById(inputId);
        var val = parseInt(input.value) || 1;
        val += delta;
        if (val < 1) val = 1;
        input.value = val;
        input.dispatchEvent(new Event('change'));
    }
    
    // Alert 
    function customAlert(message) {
        const overlay = document.createElement('div');
        overlay.className = 'custom-alert-overlay';
        
        const alertBox = document.createElement('div');
        alertBox.className = 'custom-alert';
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'custom-alert-message';
        messageDiv.textContent = message;
        
        const button = document.createElement('button');
        button.className = 'custom-alert-button';
        button.textContent = 'OK';
        button.onclick = function() {
            document.body.removeChild(overlay);
            document.body.removeChild(alertBox);
        };
        
        alertBox.appendChild(messageDiv);
        alertBox.appendChild(button);
        
        document.body.appendChild(overlay);
        document.body.appendChild(alertBox);
    }
    
    const philippineHolidays = [
        // every year nani nga holiday guys
        { month: 0, day: 1 },   // New Year's Day
        { month: 3, day: 9 },   // Araw ng Kagitingan
        { month: 4, day: 1 },   // Labor Day
        { month: 5, day: 12 },  // Independence Day
        { month: 7, day: 21 },  // Ninoy Aquino Day
        { month: 7, day: 28 },  // National Heroes Day 
        { month: 10, day: 1 },  // All Saints' Day
        { month: 10, day: 30 }, // Bonifacio Day
        { month: 11, day: 25 }, // Christmas
        { month: 11, day: 30 }, // Rizal Day
    ];
    
    function isHoliday(date) {
        const month = date.getMonth();
        const day = date.getDate();
        return philippineHolidays.some(h => h.month === month && h.day === day);
    }
    
    function isTuesday(date) {
        return date.getDay() === 2; 
    }
    
    function validatePickupDate() {
        const pickupDate = document.getElementById('pickup-date').value;
        
        if (pickupDate) {
            const selectedDate = new Date(pickupDate + 'T00:00:00');
            if (isTuesday(selectedDate)) {
                customAlert('Sorry, we are not available on Tuesdays. Please select another day.');
                document.getElementById('pickup-date').value = '';
                return false;
            }
            if (isHoliday(selectedDate)) {
                customAlert('Sorry, we are not available on holidays. Please select another day.');
                document.getElementById('pickup-date').value = '';
                return false;
            }
        }
        return true;
    }
    
    function validatePickupTime() {
        const pickupTime = document.getElementById('pickup-time').value;
        
        if (pickupTime) {
            const [hours, minutes] = pickupTime.split(':').map(Number);
            const timeInMinutes = hours * 60 + minutes;
            const minTime = 6 * 60; // 6:00 AM
            const maxTime = 18 * 60; // 6:00 PM
            
            if (timeInMinutes < minTime || timeInMinutes > maxTime) {
                customAlert('Pickup time must be between 6:00 AM and 6:00 PM.');
                document.getElementById('pickup-time').value = '';
                return false;
            }
        }
        return true;
    }
    
    function saveSchedule() {
        const pickupDate = document.getElementById('pickup-date').value;
        const pickupTime = document.getElementById('pickup-time').value;
        
        if (pickupDate) {
            const selectedDate = new Date(pickupDate + 'T00:00:00');
            if (isTuesday(selectedDate)) {
                customAlert('Sorry, pickups are not available on Tuesdays. Please select another day.');
                return;
            }
            if (isHoliday(selectedDate)) {
                customAlert('Sorry, pickups are not available on holidays. Please select another day.');
                return;
            }
        }
        
        if (pickupTime) {
            const [hours, minutes] = pickupTime.split(':').map(Number);
            const timeInMinutes = hours * 60 + minutes;
            const minTime = 6 * 60; // 6:00 AM
            const maxTime = 18 * 60; // 6:00 PM
            
            if (timeInMinutes < minTime || timeInMinutes > maxTime) {
                customAlert('Pickup time must be between 6:00 AM and 6:00 PM.');
                return;
            }
        }
        
        document.getElementById('hiddenPickupDate').value = pickupDate || '';
        document.getElementById('hiddenPickupTime').value = pickupTime || '';
        
        const scheduleBtn = document.querySelector('button.v245_298');
        if (scheduleBtn) {
            if (pickupDate || pickupTime) {
                scheduleBtn.classList.add('selected');
                toggleBoxHighlight('.v245_297', true);
            } else {
                scheduleBtn.classList.remove('selected');
                toggleBoxHighlight('.v245_297', false);
            }
        }
        
        closeScheduleModal();
    }
    
    function saveNote() {
        const noteText = document.getElementById('note-text').value.trim();
    
        document.getElementById('hiddenOrderNote').value = noteText || '';
    
        const noteBtn = document.querySelector('button.v244_290');
        if (noteText) {
            noteBtn.classList.add('selected');
            toggleBoxHighlight('.v244_285', true);
        } else {
            noteBtn.classList.remove('selected');
            toggleBoxHighlight('.v244_285', false);
        }
        
        document.getElementById('noteModal').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', function() {
        function updateTotals() {
            let detTotal = 0;
            let anyDetSelected = false;
            document.querySelectorAll('.detergent-checkbox').forEach(cb => {
                if (cb.checked) {
                    anyDetSelected = true;
                    const id = cb.value;
                    const qty = parseInt(document.getElementById('detergent_qty_' + id).value) || 1;
                    const price = parseFloat(document.querySelector('[name="detergent_price_' + id + '"]').value) || 0;
                    detTotal += qty * price;
                }
            });
            document.getElementById('detergentTotal').textContent = 'Price: ' + detTotal.toFixed(2);
            const detergentBtn = document.querySelector('button.v100_145');
            if (anyDetSelected) {
                detergentBtn.classList.add('selected');
            } else {
                detergentBtn.classList.remove('selected');
            }

            let fabTotal = 0;
            let anyFabSelected = false;
            document.querySelectorAll('.fabcon-checkbox').forEach(cb => {
                if (cb.checked) {
                    anyFabSelected = true;
                    const id = cb.value;
                    const qty = parseInt(document.getElementById('fabcon_qty_' + id).value) || 1;
                    const price = parseFloat(document.querySelector('[name="fabcon_price_' + id + '"]').value) || 0;
                    fabTotal += qty * price;
                }
            });
            document.getElementById('fabconTotal').textContent = 'Price: ' + fabTotal.toFixed(2);
            const fabconBtn = document.querySelector('button.v100_147');
            if (anyFabSelected) {
                fabconBtn.classList.add('selected');
            } else {
                fabconBtn.classList.remove('selected');
            }
        }
        function toggleButtonSelected(btn, input) {
            if (input.value === '1') {
                btn.classList.add('selected');
            } else {
                btn.classList.remove('selected');
            }
        }
        
        // Own Detergent
        const ownDetBtn = document.getElementById('ownDetergentBtn');
        const ownDetInput = document.getElementById('ownDetergentInput');
        ownDetBtn.addEventListener('click', function() {
            var isActive = ownDetInput.value === '1';
            ownDetInput.value = isActive ? '0' : '1';
            toggleButtonSelected(ownDetBtn, ownDetInput);
            toggleBoxHighlight('.v100_140', !isActive);
            if (!isActive) {
                document.querySelectorAll('.detergent-checkbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.detergent-option').forEach(opt => opt.classList.remove('selected'));
                toggleBoxHighlight('.v100_133', false);
            }
            updateTotals();
        });
        toggleButtonSelected(ownDetBtn, ownDetInput);
        toggleBoxHighlight('.v100_140', ownDetInput.value === '1');
        
        const ownFabBtn = document.getElementById('ownFabconBtn');
        const ownFabInput = document.getElementById('ownFabconInput');
        ownFabBtn.addEventListener('click', function() {
            var isActive = ownFabInput.value === '1';
            ownFabInput.value = isActive ? '0' : '1';
            toggleButtonSelected(ownFabBtn, ownFabInput);
            toggleBoxHighlight('.v100_151', !isActive);
            if (!isActive) {
                document.querySelectorAll('.fabcon-checkbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('#fabconModal .detergent-option').forEach(opt => opt.classList.remove('selected'));
                toggleBoxHighlight('.v100_138', false);
            }
            updateTotals();
        });
        toggleButtonSelected(ownFabBtn, ownFabInput);
        toggleBoxHighlight('.v100_151', ownFabInput.value === '1');
        
        document.querySelectorAll('.detergent-checkbox').forEach(cb => {
            cb.addEventListener('change', function() {
                if (this.checked) {
                    ownDetInput.value = '0';
                    toggleButtonSelected(ownDetBtn, ownDetInput);
                    toggleBoxHighlight('.v100_140', false);
                }
                const opt = this.closest('.detergent-option');
                if (opt) {
                    if (this.checked) opt.classList.add('selected');
                    else opt.classList.remove('selected');
                }
                
                const anyDetSelected = Array.from(document.querySelectorAll('.detergent-checkbox')).some(cb => cb.checked);
                toggleBoxHighlight('.v100_133', anyDetSelected);
                
                updateTotals();
            });
        });
        document.querySelectorAll('.fabcon-checkbox').forEach(cb => {
            cb.addEventListener('change', function() {
                if (this.checked) {
                    ownFabInput.value = '0';
                    toggleButtonSelected(ownFabBtn, ownFabInput);
                    toggleBoxHighlight('.v100_151', false);
                }
                const opt = this.closest('.detergent-option');
                if (opt) {
                    if (this.checked) opt.classList.add('selected');
                    else opt.classList.remove('selected');
                }
                
                const anyFabSelected = Array.from(document.querySelectorAll('.fabcon-checkbox')).some(cb => cb.checked);
                toggleBoxHighlight('.v100_138', anyFabSelected);
                
                updateTotals();
            });
        });
        document.querySelectorAll('.quantity input[type="number"]').forEach(inp => {
            inp.addEventListener('change', updateTotals);
        });
        {% if order_type != 'Self-service' %}
        const ironBtn = document.getElementById('ironBtn');
        const ironInput = document.getElementById('ironInput');
        if (ironBtn && ironInput) {
            ironBtn.addEventListener('click', function() {
                ironInput.value = ironInput.value === '1' ? '0' : '1';
                toggleButtonSelected(ironBtn, ironInput);
                toggleBoxHighlight('.v100_163', ironInput.value === '1');
            });
            toggleButtonSelected(ironBtn, ironInput);
            toggleBoxHighlight('.v100_163', ironInput.value === '1');
        }
        
        const foldBtn = document.getElementById('foldBtn');
        const foldInput = document.getElementById('foldInput');
        if (foldBtn && foldInput) {
            foldBtn.addEventListener('click', function() {
                foldInput.value = foldInput.value === '1' ? '0' : '1';
                toggleButtonSelected(foldBtn, foldInput);
                toggleBoxHighlight('.v100_165', foldInput.value === '1');
            });
            toggleButtonSelected(foldBtn, foldInput);
            toggleBoxHighlight('.v100_165', foldInput.value === '1');
        }
        
        const priorityBtn = document.getElementById('priorityBtn');
        const priorityInput = document.getElementById('priorityInput');
        if (priorityBtn && priorityInput) {
            priorityBtn.addEventListener('click', function() {
                priorityInput.value = priorityInput.value === '1' ? '0' : '1';
                toggleButtonSelected(priorityBtn, priorityInput);
                toggleBoxHighlight('.v244_284', priorityInput.value === '1');
            });
            toggleButtonSelected(priorityBtn, priorityInput);
            toggleBoxHighlight('.v244_284', priorityInput.value === '1');
        }
        {% endif %}
        updateTotals();
    });
</script>
</html>